Denormalized names (client_name, project_name) in relational tables

Invoices linked to clients via name instead of ID

Security assumption: ‚ÄúRLS disabled + service key forever‚Äù

These are not theoretical issues. They will cause:

Data inconsistency

Painful refactors

Migration headaches

Silent bugs

The good news:
‚úÖ These are easy to fix now, impossible later.

2Ô∏è‚É£ REQUIRED CORRECTIONS (NON-NEGOTIABLE)
üî¥ CORRECTION #1: REMOVE DENORMALIZED NAMES
‚ùå Current (Problematic)
projects.client_name
invoices.client_name
invoices.project_name

Why this is dangerous

Client name changes ‚Üí invoices break

Typos create orphan records

No referential integrity

Impossible to enforce consistency

Databases exist to prevent this exact problem.

‚úÖ Correct Design

Use IDs only, derive names at query time.

projects.client_id ‚Üí clients.id
invoices.client_id ‚Üí clients.id
invoices.project_id ‚Üí projects.id


Frontend already fetches related data ‚Äî this costs you nothing.

üî¥ CORRECTION #2: INVOICES MUST NOT LINK ‚ÄúVIA NAME‚Äù

Your current relationship:

clients ‚îÄ‚îÄ invoices (via client_name)


This is not acceptable in production.

‚úÖ Correct relationship
clients (id) ‚îÄ‚îÄ invoices.client_id
projects (id) ‚îÄ‚îÄ invoices.project_id (optional)


This gives you:

Retainers (invoice without project)

Project invoices

Clean joins

Zero ambiguity

üî¥ CORRECTION #3: SECURITY MODEL MUST BE FUTURE-SAFE

Your current statement:

‚ÄúRLS disabled, all access via service key‚Äù

This is OK for now, but dangerous if not framed correctly.

‚úÖ Correct framing

RLS enabled

Policies set to deny all

Service role bypasses RLS

Auth can be added later without schema changes

This prevents accidental exposure if someone later enables anon access.

3Ô∏è‚É£ FINAL GREEN-LIGHT ARCHITECTURE (APPROVED)

Below is the corrected, production-safe version of your plan.

‚úÖ FINAL DATABASE SCHEMA (APPROVED)
clients
id uuid PK
name text NOT NULL
email text
phone text
notes text
created_at timestamptz DEFAULT now()

email_accounts
id uuid PK
email text UNIQUE NOT NULL
password text NOT NULL
provider text NOT NULL
status text NOT NULL
tags text[]
notes text
created_at timestamptz DEFAULT now()

projects
id uuid PK
client_id uuid FK ‚Üí clients.id
project_name text NOT NULL
domain_name text
domain_provider text
domain_email_id uuid FK ‚Üí email_accounts.id
domain_username text
deployment_email_id uuid FK ‚Üí email_accounts.id
deployment_username text
hosting_platform text DEFAULT 'Netlify'
domain_purchase_date date
domain_renewal_date date
hosting_start_date date
hosting_renewal_date date
status text NOT NULL
project_amount numeric
payment_status text
pending_amount numeric
completed_date date
attention_state text
notes text
created_at timestamptz DEFAULT now()

invoices
id uuid PK
invoice_number text UNIQUE NOT NULL
client_id uuid FK ‚Üí clients.id
project_id uuid FK ‚Üí projects.id NULL
invoice_date date NOT NULL
due_date date
subtotal numeric NOT NULL
tax_rate numeric
discount numeric
total numeric NOT NULL
paid_amount numeric
payment_status text NOT NULL
notes text
created_at timestamptz DEFAULT now()

invoice_items
id uuid PK
invoice_id uuid FK ‚Üí invoices.id
description text NOT NULL
quantity numeric NOT NULL
rate numeric NOT NULL
amount numeric NOT NULL

ai_subscriptions
id uuid PK
project_id uuid FK ‚Üí projects.id NULL
tool_name text NOT NULL
subscription_type text NOT NULL
email_id uuid FK ‚Üí email_accounts.id
cancel_by_date date
cost numeric
notes text
created_at timestamptz DEFAULT now()

4Ô∏è‚É£ EVERYTHING ELSE IN YOUR PLAN IS ‚úÖ CORRECT

These parts are approved without change:

‚úÖ Supabase + Netlify Functions
‚úÖ No frontend DB access
‚úÖ Serverless CRUD APIs
‚úÖ Migration via JSON
‚úÖ API-driven frontend switch
‚úÖ Cost estimates
‚úÖ Folder structure
‚úÖ Environment variable handling

You clearly understand production systems ‚Äî this just needed tightening.
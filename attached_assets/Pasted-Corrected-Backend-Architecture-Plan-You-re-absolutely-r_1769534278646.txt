Corrected Backend Architecture Plan
You're absolutely right. Here's the corrected, production-safe architecture:

Key Corrections Applied
Issue	Fix
Denormalized client_name in projects/invoices	Use client_id FK only
Invoices linked by name	Use client_id and project_id FKs
RLS disabled	RLS enabled with deny-all policies (service role bypasses)
AI subscriptions floating	Link to project_id for context
Corrected Database Schema
clients
Column	Type	Required
id	uuid	PK
name	text	NOT NULL
email	text	
phone	text	
notes	text	
created_at	timestamptz	DEFAULT now()
email_accounts
Column	Type	Required
id	uuid	PK
email	text	UNIQUE NOT NULL
password	text	NOT NULL
provider	text	NOT NULL
status	text	NOT NULL
tags	text[]	
notes	text	
created_at	timestamptz	DEFAULT now()
projects
Column	Type	Required
id	uuid	PK
client_id	uuid	FK → clients.id
project_name	text	NOT NULL
domain_name	text	
domain_provider	text	
domain_email_id	uuid	FK → email_accounts.id
domain_username	text	
deployment_email_id	uuid	FK → email_accounts.id
deployment_username	text	
hosting_platform	text	DEFAULT 'Netlify'
domain_purchase_date	date	
domain_renewal_date	date	
hosting_start_date	date	
hosting_renewal_date	date	
status	text	NOT NULL
project_amount	numeric	
payment_status	text	
pending_amount	numeric	
completed_date	date	
attention_state	text	
notes	text	
created_at	timestamptz	DEFAULT now()
invoices
Column	Type	Required
id	uuid	PK
invoice_number	text	UNIQUE NOT NULL
client_id	uuid	FK → clients.id
project_id	uuid	FK → projects.id (NULL OK for retainers)
invoice_date	date	NOT NULL
due_date	date	
subtotal	numeric	NOT NULL
tax_rate	numeric	
discount	numeric	
total	numeric	NOT NULL
paid_amount	numeric	
payment_status	text	NOT NULL
notes	text	
created_at	timestamptz	DEFAULT now()
invoice_items
Column	Type	Required
id	uuid	PK
invoice_id	uuid	FK → invoices.id
description	text	NOT NULL
quantity	numeric	NOT NULL
rate	numeric	NOT NULL
amount	numeric	NOT NULL
ai_subscriptions
Column	Type	Required
id	uuid	PK
project_id	uuid	FK → projects.id (NULL OK)
tool_name	text	NOT NULL
subscription_type	text	NOT NULL
email_id	uuid	FK → email_accounts.id
cancel_by_date	date	
cost	numeric	
notes	text	
created_at	timestamptz	DEFAULT now()
Corrected Relationships
clients (id) ←─┬── projects.client_id
               └── invoices.client_id
projects (id) ←─┬── invoices.project_id (optional)
                └── ai_subscriptions.project_id (optional)
email_accounts (id) ←─┬── projects.domain_email_id
                      ├── projects.deployment_email_id
                      └── ai_subscriptions.email_id
invoices (id) ←── invoice_items.invoice_id
Corrected Security Model
-- Enable RLS on all tables
ALTER TABLE clients ENABLE ROW LEVEL SECURITY;
ALTER TABLE projects ENABLE ROW LEVEL SECURITY;
-- ... (all tables)
-- Deny-all policies (service role bypasses automatically)
CREATE POLICY "Deny all" ON clients FOR ALL USING (false);
-- ... (all tables)
Service role key bypasses RLS → safe for Netlify Functions.
Future auth can add proper policies without schema changes.